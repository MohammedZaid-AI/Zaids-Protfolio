<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <header class="admin-header">
        <div class="container">
            <h1>Admin</h1>
            <nav>
                <a href="{{ url_for('index') }}">View site</a>
                <a href="{{ url_for('admin_logout') }}">Logout</a>
            </nav>
        </div>
    </header>
    <main class="container">
        <section class="card">
            <h2>Messages</h2>
            {% if messages %}
            <div class="grid">
                {% for m in messages %}
                <div class="project" style="padding: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <strong>{{ m['name'] }}</strong>
                        <span class="muted" style="font-size: 0.9em;">{{ m['timestamp'][:10] }}</span>
                    </div>
                    <div style="font-size: 0.9em; margin-bottom: 8px; color: var(--accent);">{{ m['email'] }}</div>
                    <p style="margin: 0 0 12px;">{{ m['message'] }}</p>
                    <form method="post" action="{{ url_for('admin_messages_delete', mid=m['id']) }}">
                        <button type="submit" class="danger"
                            style="padding: 6px 10px; font-size: 0.9em;">Delete</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="muted">No messages yet.</p>
            {% endif %}
        </section>

        <section class="card">
            <h2>Profile</h2>
            <form method="post" action="{{ url_for('admin_profile') }}" enctype="multipart/form-data">
                <div class="grid-2">
                    <div>
                        <label>Name</label>
                        <input type="text" name="name" value="{{ profile['name'] }}">
                    </div>
                    <div>
                        <label>Tagline</label>
                        <input type="text" name="tagline" value="{{ profile['tagline'] }}">
                    </div>
                </div>
                <label>About</label>
                <textarea name="about" rows="4">{{ profile['about'] }}</textarea>
                <div class="grid-2">
                    <div>
                        <label>Avatar</label>
                        <input type="file" name="avatar" accept="image/*">
                    </div>
                    <div>
                        {% if profile['avatar_path'] %}
                        <img class="avatar small"
                            src="{{ url_for('static', filename=profile['avatar_path']|replace('\\', '/')) }}"
                            alt="avatar">
                        {% endif %}
                    </div>
                    <div>
                        <label>Back Avatar (Flip)</label>
                        <input type="file" name="avatar_back" accept="image/*">
                    </div>
                    <div>
                        {% if profile['avatar_back_path'] %}
                        <img class="avatar small"
                            src="{{ url_for('static', filename=profile['avatar_back_path']|replace('\\', '/')) }}"
                            alt="back avatar">
                        <p class="muted" style="margin-top: 4px; font-size: 0.8em;">Current Back</p>
                        {% endif %}
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>GitHub</label>
                        <input type="url" name="github" value="{{ profile['github'] }}">
                    </div>
                    <div>
                        <label>Twitter</label>
                        <input type="url" name="twitter" value="{{ profile['twitter'] }}">
                    </div>
                    <div>
                        <label>LinkedIn</label>
                        <input type="url" name="linkedin" value="{{ profile['linkedin'] }}">
                    </div>
                    <div>
                        <label>Website</label>
                        <input type="url" name="website" value="{{ profile['website'] }}">
                    </div>
                </div>
                <button type="submit">Save Profile</button>
            </form>
        </section>

        <section class="card">
            <h2>Research Papers</h2>
            <form method="post" action="{{ url_for('admin_research_add') }}" enctype="multipart/form-data">
                <div class="grid-2">
                    <div>
                        <label>Title</label>
                        <input type="text" name="title" required>
                    </div>
                    <div>
                        <label>Publication / Conference</label>
                        <input type="text" name="publication" placeholder="e.g. IEEE 2024">
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>Date</label>
                        <input type="text" name="date" placeholder="YYYY-MM-DD" required>
                    </div>
                    <div>
                        <label>Link to Paper</label>
                        <input type="url" name="link" placeholder="https://...">
                    </div>
                </div>
                <label>Description</label>
                <textarea name="description" rows="3"></textarea>
                <button type="submit">Add Paper</button>
            </form>
            <div class="grid">
                {% for r in research_papers %}
                <div class="project" style="padding: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <strong>{{ r['title'] }}</strong>
                        <span class="muted" style="font-size: 0.9em;">{{ r['date'] }}</span>
                    </div>
                    <div style="font-size: 0.9em; margin-bottom: 8px; color: var(--accent);">{{ r['publication'] }}
                    </div>
                    <p style="margin: 0 0 12px;">{{ r['description'] }}</p>
                    <div style="display: flex; gap: 8px;">
                        <a href="{{ url_for('admin_research_edit', rid=r['id']) }}" class="button"
                            style="background: var(--muted); padding: 6px 10px; font-size: 0.9em;">Edit</a>
                        <form method="post" action="{{ url_for('admin_research_delete', rid=r['id']) }}"
                            style="margin:0;">
                            <button type="submit" class="danger"
                                style="padding: 6px 10px; font-size: 0.9em;">Delete</button>
                        </form>
                    </div>
                </div>
                {% else %}
                <p class="muted">No research papers added.</p>
                {% endfor %}
            </div>
        </section>

        <section class="card">
            <h2>Skills</h2>
            <form method="post" action="{{ url_for('admin_skills_add') }}" class="inline">
                <input type="text" name="name" placeholder="e.g. TypeScript">
                <label class="inline-check"><input type="checkbox" name="exploring"> Figuring out</label>
                <button type="submit">Save Skill</button>
            </form>
            <div class="pill-row">
                {% for s in skills %}
                <span class="pill">{{ s['name'] }}{% if s['exploring'] %} • exploring{% endif %}</span>
                <div style="display: inline-flex; gap: 4px;">
                    <a href="{{ url_for('admin_skills_edit', sid=s['id']) }}" class="button"
                        style="padding: 4px 8px; font-size: 0.8em; background: var(--muted);">Edit</a>
                    <form method="post" action="{{ url_for('admin_skills_delete', sid=s['id']) }}" class="inline"
                        style="margin:0;">
                        <button type="submit" class="danger" style="padding: 4px 8px; font-size: 0.8em;">Del</button>
                    </form>
                </div>
                {% else %}
                <span class="muted">Add your skills.</span>
                {% endfor %}
            </div>
        </section>



        <section class="card">
            <h2>Add Project</h2>
            <form method="post" action="{{ url_for('admin_projects_add') }}" enctype="multipart/form-data">
                <label>Title</label>
                <input type="text" name="title" required>
                <label>Description</label>
                <textarea name="description" rows="3"></textarea>
                <label>Link</label>
                <input type="url" name="link">
                <label>GitHub Link</label>
                <input type="url" name="github_link">
                <label>Image</label>
                <input type="file" name="image" accept="image/*">
                <button type="submit">Save Project</button>
            </form>
            <div class="grid">
                {% for p in projects %}
                <article class="project">
                    {% if p['image_path'] %}
                    <img src="{{ url_for('static', filename=p['image_path']|replace('\\', '/')) }}"
                        alt="{{ p['title'] }}">
                    {% endif %}
                    <div class="content">
                        <h3>{{ p['title'] }}</h3>
                        <p>{{ p['description'] }}</p>
                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                            <a href="{{ url_for('admin_projects_edit', pid=p['id']) }}" class="button"
                                style="background: var(--muted);">Edit</a>
                            <form method="post" action="{{ url_for('admin_projects_delete', pid=p['id']) }}"
                                style="margin:0;">
                                <button type="submit" class="danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
        </section>

        <section class="card">
            <h2>Add Experience</h2>
            <form method="post" action="{{ url_for('admin_experience_add') }}" enctype="multipart/form-data">
                <div class="grid-2">
                    <div>
                        <label>Role</label>
                        <input type="text" name="role" required>
                    </div>
                    <div>
                        <label>Company</label>
                        <input type="text" name="company" required>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>Start Date</label>
                        <input type="text" name="start_date" placeholder="YYYY-MM">
                    </div>
                    <div>
                        <label>End Date</label>
                        <input type="text" name="end_date" placeholder="YYYY-MM or Present">
                    </div>
                </div>
                <label>Logo</label>
                <input type="file" name="logo" accept="image/*">
                <label>Description</label>
                <textarea name="description" rows="3"></textarea>
                <button type="submit">Save Experience</button>
            </form>
            <ul class="timeline">
                {% for e in experience %}
                <li>
                    <div class="row">
                        <strong>{{ e['role'] }}</strong>
                        <span class="company">{{ e['company'] }}</span>
                        <span class="dates">{{ e['start_date'] }}{% if e['end_date'] %} → {{ e['end_date'] }}{% endif
                            %}</span>
                    </div>
                    <p>{{ e['description'] }}</p>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <a href="{{ url_for('admin_experience_edit', eid=e['id']) }}" class="button"
                            style="background: var(--muted); padding: 6px 12px; font-size: 0.9em;">Edit</a>
                        <form method="post" action="{{ url_for('admin_experience_delete', eid=e['id']) }}"
                            style="margin:0;">
                            <button type="submit" class="danger"
                                style="padding: 6px 12px; font-size: 0.9em;">Delete</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </section>
    </main>
</body>

</html>